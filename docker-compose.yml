services:
  gws_mcp:
    build: .
    container_name: gws_mcp
    ports:
      - "${PORT:-3000}:${PORT:-3000}"
    environment:
      - GOOGLE_MCP_CREDENTIALS_DIR=/app/store_creds
      - DATABASE_URL=${DATABASE_URL}
      - PORT=${PORT:-3000}
      - MASTER_KEY=${MASTER_KEY}
      - API_KEY_MODE=user_bound
      - REDIRECT_URI_ALLOWLIST=localhost,127.0.0.1
    volumes:
      - ./client_secret.json:/app/client_secret.json:ro
      - store_creds:/app/store_creds:rw
    env_file:
      - .env
    depends_on:
      - db

  db:
    image: postgres:16-alpine
    container_name: gws_mcp_db
    environment:
      POSTGRES_DB: gws_mcp
      POSTGRES_USER: gws_mcp
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    ports:
      - "5432:5432"
    volumes:
      - gws_mcp_db:/var/lib/postgresql/data

volumes:
  store_creds:
  gws_mcp_db:
